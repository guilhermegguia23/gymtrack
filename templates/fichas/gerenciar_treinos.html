{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
    <div>
      <h5 class="mb-0">Treinos da Ficha</h5>
      <small class="text-muted">Ficha de {{ ficha.aluno.nome }} {% if ficha.nome %}- {{ ficha.nome }}{% endif %}</small>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary btn-sm" href="{% url 'treinos:lista_fichas' %}">Voltar</a>
      <a class="btn btn-outline-success btn-sm" href="{% url 'treinos:ativar_ficha' ficha_id=ficha.id %}">Marcar como ativa</a>
    </div>
  </div>
  <div class="card-body">
    <h6 class="mb-3">
      {% if treino_em_edicao %}
        Atualizar treino ({{ treino_em_edicao.nome }})
      {% else %}
        Cadastrar novo treino (A, B, C...)
      {% endif %}
    </h6>
    <form method="post" class="row g-3 mb-4">
      {% csrf_token %}
      {% if treino_em_edicao %}
        <input type="hidden" name="treino_id" value="{{ treino_em_edicao.id }}">
      {% endif %}
      {% for field in form %}
        <div class="col-md-4">
          <label class="form-label" for="{{ field.id_for_label }}">{{ field.label }}</label>
          {{ field }}
          {% if field.errors %}
            <div class="invalid-feedback d-block">{{ field.errors|striptags }}</div>
          {% endif %}
        </div>
      {% endfor %}
      <div class="col-12">
        <div class="d-flex gap-2">
          <button class="btn btn-primary" type="submit">
            {% if treino_em_edicao %}Atualizar{% else %}Adicionar{% endif %}
          </button>
          {% if treino_em_edicao %}
            <a class="btn btn-outline-secondary" href="{% url 'treinos:gerenciar_treinos' ficha_id=ficha.id %}">Cancelar</a>
          {% endif %}
        </div>
      </div>
    </form>

    <h6 class="mb-2">Treinos cadastrados</h6>
    {% if treinos %}
      <div class="list-group">
        {% for treino in treinos %}
          <div class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <strong>Treino {{ treino.nome }}</strong>
              <small class="text-muted ms-2">Ordem {{ treino.ordem }}</small>
            </div>
            <div class="d-flex gap-2">
              <a class="btn btn-outline-secondary btn-sm" href="?editar={{ treino.id }}">Editar</a>
              <a class="btn btn-outline-primary btn-sm" href="{% url 'treinos:editar_treino_exercicios' treino_id=treino.id %}">Exerc√≠cios</a>
              <form method="post" action="{% url 'treinos:remover_treino' treino_id=treino.id %}" onsubmit="return confirm('Remover este treino?')">
                {% csrf_token %}
                <button class="btn btn-outline-danger btn-sm" type="submit">Remover</button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted">Nenhum treino cadastrado ainda.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
