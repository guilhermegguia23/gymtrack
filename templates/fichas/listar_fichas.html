{% extends "base.html" %}
{% block content %}

<div class="card table-card">
  <div class="card-header d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2">
    <div>
      <h2 class="h4 mb-0">Fichas de Treino</h2>
      <p class="text-muted mb-0">Visualize as fichas de treino, seus treinos e status.</p>
    </div>
  </div>

  <div class="card-body">

    {% if page_obj and page_obj.object_list %}
      <div class="table-responsive">
        <table class="table table-hover align-middle data-table">
          <thead>
            <tr>
              <th scope="col">
                {% with next_dir=sort_options.nome %}
                <a class="table-sort {% if current_sort == 'nome' %}table-sort--active{% endif %}"
                   href="?ordenar=nome&direcao={{ next_dir }}">
                  Nome da Ficha
                  {% if current_sort == 'nome' %}
                    <span class="table-sort__icon table-sort__icon--{{ current_direction }}"></span>
                  {% endif %}
                </a>
                {% endwith %}
              </th>

              <th scope="col">
                {% with next_dir=sort_options.aluno %}
                <a class="table-sort {% if current_sort == 'aluno' %}table-sort--active{% endif %}"
                   href="?ordenar=aluno&direcao={{ next_dir }}">
                  Aluno
                  {% if current_sort == 'aluno' %}
                    <span class="table-sort__icon table-sort__icon--{{ current_direction }}"></span>
                  {% endif %}
                </a>
                {% endwith %}
              </th>

              <th scope="col">Treinos</th>
              <th scope="col">Status</th>
              <th scope="col" class="text-end">Ações</th>

            </tr>
          </thead>

          <tbody>
            {% for ficha in page_obj %}
              <tr>
                <td>
                  <strong>{{ ficha.nome }}</strong>
                </td>

                <td>
                  {{ ficha.aluno.nome }}
                </td>

                <td>
                  <ul class="mb-0 small">
                    {% for treino in ficha.treinos.all %}
                      <li><strong>{{ treino.nome }}</strong> (ordem {{ treino.ordem }})</li>
                    {% empty %}
                      <li class="text-muted">Nenhum treino cadastrado.</li>
                    {% endfor %}
                  </ul>
                </td>
                <td>
                  {% if ficha.ativa %}
                    <span class="badge bg-success">Ativa</span>
                  {% else %}
                    <span class="badge bg-secondary">Inativa</span>
                  {% endif %}
                </td>
                <td class="text-end">
                  <a class="btn btn-outline-primary btn-sm" href="{% url 'treinos:gerenciar_treinos' ficha_id=ficha.id %}">Gerenciar</a>
                </td>

              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    {% else %}
      <div class="text-center text-muted py-5">
        Nenhuma ficha cadastrada.
      </div>
    {% endif %}

  </div>

  {% if page_obj %}
  <div class="card-footer d-flex flex-column flex-md-row gap-2 align-items-md-center justify-content-between">

    {% if page_obj.paginator.count %}
      <small class="text-muted">
        Exibindo {{ page_obj.start_index }}–{{ page_obj.end_index }} de {{ page_obj.paginator.count }} fichas
      </small>
    {% endif %}

    <nav aria-label="Paginação">
      <ul class="pagination pagination-sm mb-0">

        <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
          {% if page_obj.has_previous %}
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Anterior</a>
          {% else %}
            <span class="page-link">Anterior</span>
          {% endif %}
        </li>

        {% for num in page_obj.paginator.page_range %}
          <li class="page-item {% if num == page_obj.number %}active{% endif %}">
            {% if num == page_obj.number %}
              <span class="page-link">{{ num }}</span>
            {% else %}
              <a class="page-link" href="?page={{ num }}">{{ num }}</a>
            {% endif %}
          </li>
        {% endfor %}

        <li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
          {% if page_obj.has_next %}
            <a class="page-link" href="?page={{ page_obj.next_page_number }}">Próximo</a>
          {% else %}
            <span class="page-link">Próximo</span>
          {% endif %}
        </li>

      </ul>
    </nav>

  </div>
  {% endif %}

</div>

{% endblock %}
